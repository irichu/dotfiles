autoinstall:
  version: 1
  identity:
    hostname: ubuntu-desktop
    realname: "User"
    username: user
    password: "<your-password>" # openssl passwd -6 <your-password>
  locale: "en_US.UTF-8"
  #locale: "ja_JP.UTF-8"
  keyboard:
    layout: us
    variant: ""
    toggle: null
  source:
    id: ubuntu-desktop-minimal # ubuntu-server-minimal
  #interactive-sections:
  #  - network
  #network:
  #  # network configuration (e.g., interfaces, wifi, etc.)
  #  version: 2
  #  ethernets:
  #    enp0s31f6:
  #      dhcp6: true
  #proxy: http://172.16.90.1:3128
  apt:
    mirror-selection:
      primary:
        - uri: "http://jp.archive.ubuntu.com/ubuntu"
        #- uri: "http://archive.ubuntu.com/ubuntu"
    fallback: abort
  storage:
    layout:
      name: lvm
      sizing-policy: all
      #password: LUKS_PASSPHRASE
  timezone: Asia/Tokyo
  ubuntu-pro:
    # Enable Ubuntu-Pro using a contract token
    # Note that the example below is an invalid contract token.
    #token: "your-ubuntu-pro-contract-token"
  ssh:
    install-server: true
    authorized-keys:
      # replace with the contents of the public key(s) as generated by
      # ssh-keygen or similar tools
      - "<your-public-key>"
    allow-pw: false
  codecs:
    install: false
  packages:
    - build-essential
    - curl
    - git
    - unzip
    - tar
  early-commands:
    - /bin/true
  late-commands:
    - curtin in-target -- bash -c 'echo "user ALL=(ALL) NOPASSWD:ALL" > /etc/sudoers.d/99-user'
    - curtin in-target -- chmod 440 /etc/sudoers.d/99-user
    - curtin in-target -- sudo -H -u user bash -c 'cd "$HOME" && curl -sL https://raw.githubusercontent.com/irichu/dotfiles/main/install.sh | bash && DEBUG=true ~/.local/bin/dots install --apt'
  error-commands:
    - tar -czf /installer-logs.tar.gz /var/log/installer/
    - journalctl -b > /installer-journal.log
